---
title: "Social Impact in Twitter"
author: "David Garcia"
date: "18.08.2016"
output: 
    html_document:
      keep_md: yes 
      fig_caption: yes
---

```{r setup, eval=TRUE, echo=TRUE, cache=TRUE, message=FALSE, results='hide'}
download.file("https://www.sg.ethz.ch/media/medialibrary/2016/09/03_IPP_SocialInfluence.zip", destfile="03_Social_Influence.zip")
unzip("03_Social_Influence.zip", exdir = "./") 
file.remove("03_Social_Influence.zip")
```


```{r, echo=TRUE, cache=TRUE, eval=TRUE, message=FALSE}
library(arm)
library(texreg)

d <- read.table("SIdata.dat", header=T, sep="\t")
f <- d$avgRT > 0
d <- data.frame(meanscore=d$meanscore[f], score=d$score[f], avgRT=d$avgRT[f], followers=d$followers[f], incore=d$incore[f])

mRT <- bayesglm(log(avgRT) ~ log(incore+1) * log(followers+1), data=d) 
mSC <- bayesglm(log(score) ~ log(incore+1) * log(followers+1), data=d) 
mMN <- bayesglm(log(meanscore) ~ log(incore+1) * log(followers+1), data=d) 

screenreg(list(mRT,mSC,mMN), digits=4)
```

```{r, echo=TRUE, cache=TRUE, eval=TRUE, message=FALSE}
library(lmtest)

m1 <- bayesglm(log(avgRT) ~ log(followers+1), data=d)                                       
m2 <- bayesglm(log(avgRT) ~ log(incore+1), data=d)     
lrtest(m1,m2)

m1 <- bayesglm(log(meanscore) ~ log(followers+1), data=d)                                       
m2 <- bayesglm(log(meanscore) ~ log(incore+1), data=d)     
lrtest(m1,m2)
```


```{r, echo=TRUE, cache=TRUE, eval=TRUE, fig.width=6, fig.height=2.5, message=FALSE}
par(mar=c(4,4,0,0))
par(mfrow=c(1,3))
hist(log(d$avgRT), main="", xlab="log mean RT")
hist(d$score, main="", xlab="Klout score")
hist(d$meanscore, main="", xlab="Mean influenced klout score")
```


```{r, echo=TRUE, cache=TRUE, eval=TRUE, fig.width=8, fig.height=3}
par(mar=c(4,5,1.5,0.5))
par(mfrow=c(1,3))

hist(residuals(mRT), main="", xlab="Residual RT Model", cex.axis=2,cex.lab=2)
hist(residuals(mSC), main="", xlab="Residual KS Model", cex.axis=2,cex.lab=2)
hist(residuals(mMN), main="", xlab="Residual IK Model", cex.axis=2,cex.lab=2)
```


```{r, echo=TRUE, cache=TRUE, eval=TRUE, fig.width=6, fig.height=4, message=FALSE}
par(mar=c(4,5,1.5,0.5))

incorevals <- c(40,50,78,100,200)
follvals <- exp(seq(0, log(max(d$followers)), by=0.01))

Pdata <- data.frame(followers=rep(follvals, length(incorevals)), incore=rep(incorevals, each=length(follvals)))
RTpred <- predict(mRT, newdata=Pdata)
Pdata$fit <- exp(RTpred)

plot(follvals, Pdata$fit[Pdata$incore==incorevals[1]], type="l", lwd=2, xlab="Popularity in 2009", ylab="Social influence (mean retweets)", xaxt="n", yaxt="n", cex.lab=1.25)
lines(follvals, Pdata$fit[Pdata$incore==incorevals[2]], col="red", lwd=2)
lines(follvals, Pdata$fit[Pdata$incore==incorevals[3]], col="blue", lwd=2)
lines(follvals, Pdata$fit[Pdata$incore==incorevals[4]], col="darkorange", lwd=2)
lines(follvals, Pdata$fit[Pdata$incore==incorevals[5]], col="purple", lwd=2)

library(sfsmisc)
eaxis(1,cex.axis=1.25)
eaxis(2,cex.axis=1.25)
legend("topleft", c("I=40", "I=50", "I=78", "I=100", "I=200"), col=c("black","red","blue","darkorange","purple"), lwd=rep(2,5), box.lwd=-1)
```

```{r, echo=TRUE, cache=TRUE, eval=TRUE, fig.width=4, fig.height=4, message=FALSE}
par(mar=c(4,5,1.5,0))
library(lattice)

incorevals <- 10^seq(0, log10(max(d$incore)), by=0.35)
follvals <- 10^seq(0, log10(max(d$followers)), by=0.35)

newdata <- data.frame(incore=rep(incorevals, length(follvals)),
                  followers=rep(follvals, each=length(incorevals)))
newdata$I09 <- log(newdata$incore+1)
newdata$F09 <- log(newdata$followers+1)
newdata$RT <- predict(mRT, newdata=newdata)
newdata$KS <- predict(mSC, newdata=newdata)
newdata$IK <- predict(mMN, newdata=newdata)

cscale <- rev(terrain.colors(24*100))
wireframe(RT~I09*F09, newdata,drape = TRUE, colorkey = TRUE,           col.regions=cscale,cex.axis=1, cex.lab=1, scales=list(arrows=FALSE), par.box=list(lty=2))
```

```{r, echo=TRUE, cache=TRUE, eval=TRUE, fig.width=4, fig.height=4, message=FALSE, warning=FALSE}
par(mar=c(4,5,1.5,0))

cscale <- rev(topo.colors(24*100))
clims <-round(range(newdata$mSCpred))*100
wireframe(KS~I09*F09, newdata,drape = TRUE, colorkey = TRUE, col.regions=cscale,cex.axis=1, cex.lab=1, scales=list(arrows=FALSE), par.box=list(lty=2))
```

```{r, echo=TRUE, cache=TRUE, eval=TRUE, fig.width=4, fig.height=4, warning=FALSE}
par(mar=c(4,5,1.5,0))

cscale <- rev(heat.colors(24*100))
clims <-round(range(newdata$mMNpred))*100
wireframe(IK~I09*F09, newdata,drape = TRUE, colorkey = TRUE,           col.regions=cscale,cex.axis=1, cex.lab=1, scales=list(arrows=FALSE), par.box=list(lty=2))

```
